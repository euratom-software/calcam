

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Calibration by point fitting &mdash; Calcam  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Calcam  documentation" href="index.html"/>
        <link rel="next" title="Calibration by manual alignment" href="gui_alignment_calib.html"/>
        <link rel="prev" title="Calcam GUI tools and launcher" href="gui_intro.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                Version 2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro_general.html">Genral Introduction to Calcam</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro_theory.html">Camera Calibration Theory</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro_theory.html#camera-model">Camera Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_theory.html#perspective-distortion-model">Perspective Distortion Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_theory.html#fisheye-distirtion-model">Fisheye Distirtion Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_theory.html#underlying-opencv-documentation">Underlying OpenCV Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="intro_install_setup.html">Installation &amp; Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro_install_setup.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_install_setup.html#download-installation">Download &amp; Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_install_setup.html#cad-models-and-image-sources">CAD Models and Image Sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_install_setup.html#upgrading-from-calcam-1-x">Upgrading from Calcam 1.x</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="intro_conventions.html">Concepts &amp; Conventions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro_conventions.html#image-pixel-coordinates">Image Pixel Coordinates</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_conventions.html#sub-views">Sub-views</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_conventions.html#cad-models">CAD Models</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">GUI App User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gui_intro.html">Calcam GUI tools and launcher</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gui_intro.html#starting-the-launcher">Starting the launcher</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Calibration by point fitting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#loading-an-image-to-calibrate">Loading an Image to Calibrate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#image-mouse-navigation">Image Mouse Navigation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#current-image-settings">Current Image Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loading-and-manipulating-a-cad-model">Loading and manipulating a CAD model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#defining-calibration-points">Defining Calibration Points</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fitting-the-camera-model">Fitting the camera model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#saving-loading-and-viewing-calibration-information">Saving / Loading and viewing calibration information</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gui_alignment_calib.html">Calibration by manual alignment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gui_alignment_calib.html#loading-an-image-to-calibrate">Loading an Image to Calibrate</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_alignment_calib.html#current-image-settings">Current Image Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_alignment_calib.html#loading-a-cad-model">Loading a CAD model</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_alignment_calib.html#performing-the-alignment-calibration">Performing the alignment calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_alignment_calib.html#saving-loading-and-viewing-calibration-information">Saving / Loading and viewing calibration information</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gui_virtual_calib.html">&#8220;Virtual&#8221; Calibrations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gui_virtual_calib.html#loading-a-cad-model">Loading a CAD model</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_virtual_calib.html#creating-the-virtual-calibration">Creating the Virtual Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_virtual_calib.html#saving-loading-and-viewing-calibration-information">Saving / Loading and viewing calibration information</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gui_image_analyser.html">Image Analyser</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gui_image_analyser.html#loading-an-image-to-analyse">Loading an image to analyse</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_image_analyser.html#loading-a-calibration">Loading a Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_image_analyser.html#loading-a-cad-model">Loading a CAD model</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_image_analyser.html#performing-position-analysis">Performing Position Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gui_viewer.html">3D Viewer</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gui_viewer.html#loading-a-cad-model">Loading a CAD model</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_viewer.html#turning-cad-model-parts-on-off">Turning CAD model parts On/Off</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_viewer.html#cad-model-appearance-settings">CAD model appearance settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_viewer.html#wall-contour-display">Wall contour display</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_viewer.html#mouse-navigation">Mouse Navigation</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_viewer.html#d-viewport-tab">3D ViewPort Tab</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_viewer.html#visualising-camera-fields-of-view">Visualising camera fields of view</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_viewer.html#displaying-arbitrary-3d-lines">Displaying Arbitrary 3D Lines</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_viewer.html#rendering-and-saving-images">Rendering and saving images</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gui_settings.html">Calcam Settings</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gui_settings.html#cad-model-definition-settings">CAD Model Definition Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_settings.html#image-source-settings">Image Source Settings</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api_analysis.html">Using Calibration Results</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api_analysis.html#the-calibration-class">The Calibration Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_analysis.html#rendering-images">Rendering images</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_analysis.html#ray-casting">Ray casting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_cadmodel.html">CAD Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api_examples.html#mapping-a-magnetic-field-line-on-ot-an-image">Mapping a magnetic field line on ot an image</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_examples.html#showing-an-efit-contour-on-an-image">Showing an EFIT contour on an image</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_examples.html#rendering-camera-view-wireframe">Rendering camera view wireframe</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_examples.html#finding-where-sight-lines-intersect-the-cad-model">Finding where sight-lines intersect the CAD model</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_examples.html#synthetic-images-with-raysect">Synthetic Images with RaySect</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dev_imsources.html">Image Sources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dev_imsources.html#return-format-of-image-loading-function">Return format of image loading function</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_imsources.html#structure-of-get-image-arguments">Structure of get_image_arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_imsources.html#example">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_imsources.html#adding-to-calcam">Adding to Calcam</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dev_coord_formatter.html">3D Coordinate Formatters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dev_coord_formatter.html#example">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_coord_formatter.html#adding-to-a-cad-model">Adding to a CAD model</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Calcam</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Calibration by point fitting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="calibration-by-point-fitting">
<h1>Calibration by point fitting<a class="headerlink" href="#calibration-by-point-fitting" title="Permalink to this headline">¶</a></h1>
<p>The point fitting calibration tool is the main GUI tool for performing camera calibrations. An image from a camera to be calibrated and a CAD model of the camera&#8217;s view are shown side-by-side, and the user then identifies pairs of corresponding points between the image and CAD model. These point pairs are then used to fit the camera calibration.</p>
<p>A screenshot of the calibration tool GUI is shown below, with the main areas annotated. At the top of the window is a toolbar with buttons to start a new calibration, open a calibration or save / save as for the opened calibration. Most of the space in the main window is taken by the side-by-side CAD and image views, where the CAD model and image to be calibrated are displayed. On the right-hand side of the window are the &#8220;control tabs&#8221;, a set of tabs where the rest of the controls reside.</p>
<img alt="Calibration tool screenshot" class="align-left" src="_images/calib_points_annotated.png" />
<div class="section" id="loading-an-image-to-calibrate">
<h2>Loading an Image to Calibrate<a class="headerlink" href="#loading-an-image-to-calibrate" title="Permalink to this headline">¶</a></h2>
<p>At the top of the <span class="guilabel">Camera Image</span> control tab is a group of controls for loading an image you want to calibrate. The <span class="guilabel">From</span> dropdown list selects the source from which you want to load the image. The options available as standard are loading from an image file (default) or loading an image from another Calcam calibration. If you define any custom image sources (see <a class="reference internal" href="dev_imsources.html"><span class="doc">Image Sources</span></a>), they will also appear in this dropdown menu. Once an image source is selected, the relevant inputs to set up the image loading appear below the dropdown list. Once the relevant fields are completed, click the <span class="guilabel">Load</span> button to load the image.</p>
</div>
<div class="section" id="image-mouse-navigation">
<h2>Image Mouse Navigation<a class="headerlink" href="#image-mouse-navigation" title="Permalink to this headline">¶</a></h2>
<p>Once an image is loaded, you can interactively zoom and pan the image with the following mouse controls:</p>
<ul class="simple">
<li><code class="kbd docutils literal"><span class="pre">Scroll</span> <span class="pre">Wheel</span></code> - Zoom in or out, centred at the current mouse position.</li>
<li><code class="kbd docutils literal"><span class="pre">Middle</span> <span class="pre">Click</span> <span class="pre">+</span> <span class="pre">Drag</span></code> - Drag the image around.</li>
</ul>
</div>
<div class="section" id="current-image-settings">
<h2>Current Image Settings<a class="headerlink" href="#current-image-settings" title="Permalink to this headline">¶</a></h2>
<p>With an image loaded, the <span class="guilabel">Current Image</span> section appears on the <span class="guilabel">Camera Image</span> tab, containing information and settings for the current image. Controls include</p>
<ul class="simple">
<li><strong>Known Pixel Size</strong>: If you know the pixel size of the camera, it can be entered here. This does not make any difference to the calibration except that focal lengths can be displayed in mm instead of pixels, which can be useful for sanity checking results e.g. comparing with optical designs or known lenses.</li>
<li><strong>Geometrical Transformations</strong>: Controls for transforming the image to get it the &#8220;right way up&#8221;. It is recommended to always load images in to Calcam the way they come out of the camera as raw, then use these controls to get the image right-way-up for calibration. The :guilabell:Stretch Vertically by&#8217; button is provided for cameras with non-square pixels or anamorphic optics.</li>
<li><strong>Histogram Equilise</strong> (only available with OpenCV 3.0+): Toggle adaptive histogram equilistion on the image display; turning this on will increase the image contrast to mak it easier to see features in the image.</li>
</ul>
<div class="section" id="images-with-multiple-sub-views">
<h3>Images with multiple sub-views<a class="headerlink" href="#images-with-multiple-sub-views" title="Permalink to this headline">¶</a></h3>
<p>If the image to be calibrated contains multiple <a class="reference internal" href="intro_conventions.html#subviews-intro"><span class="std std-ref">Sub-views</span></a>, this can be set up by clicking the <span class="guilabel">Define Sub-Views</span> button at the bottom of the image controls, which opens the below window:</p>
<img alt="Sub-view window screenshot" class="align-left" src="_images/subviews.png" />
<p>This window shows the image on the left, with the different sub-views tinted in different colours. Below the image is a slider which can be used to control the opacity of this tint effect to. Mouse navigation controls for the image are the same as for the image in the main calibration window. On the right-of the window are 3 options for defining which pixels in the image belong to which sub-view:</p>
<ul class="simple">
<li><strong>No Split Field-of-View</strong>: If the image does not have a split field-of-view (i.e. only contains a single subview) as is the case for most images. This is the default for images loaded from image files.</li>
<li><strong>2 Sub-views separated by a straight line</strong>: The simplest case for a split-view image. If this option is selected, click two points on the image to define the line which separates the two sub-views. Once the points are placed, clicking on the image again moves the selected point (shown in green) to the clicked position. The other point can be selected by clicking it.</li>
<li><strong>Custom mask</strong> for images with more than 2 sub-views or where the boundary between the sub-views is not a straight line. To use this function, prepare an image file the same size as the image to be calibrated with blocks of different solid colours representing each sub-view. You can then load this image file and the blocks of different colours will be used to define the coverage of the different sub-views.</li>
</ul>
<p>Once the positions of the sub-views have been configured, on the lower-right of the window are boxes to enter human-friendly names for the different sub-views. These will be used to identify the sub-views elsewhere in the GUI and calibration information.</p>
<p>Once this is all set to your satisfaction, click <span class="guilabel">Apply</span> to apply the sub-view configuration and return to the main window. Clicking <span class="guilabel">Cancel</span> will return to the main window without making any changes.</p>
</div>
</div>
<div class="section" id="loading-and-manipulating-a-cad-model">
<h2>Loading and manipulating a CAD model<a class="headerlink" href="#loading-and-manipulating-a-cad-model" title="Permalink to this headline">¶</a></h2>
<p>At the top the <span class="guilabel">Machine Model</span> control tab are controls for loading a CAD model to calibrate against. Two dropdown boxes are provided to select the CAD model to load and the <a class="reference internal" href="intro_conventions.html#cadmodel-intro"><span class="std std-ref">model variant</span></a>. The <span class="guilabel">Load</span> button to the right of the model variant then loads the model. Underneath the model variant dropdown box is a checkbox labeled <cite>Enable default model features on load</cite>: if checked, the default parts of the CAD model are all loaded as soon as the model itself is loaded. If not checked, the model definition will be loaded but none of the 3D mesh data will be loaded, and instead you can turn on features individually. This is useful if working with a large model on a slow computer where you don&#8217;t want to wait for the whole model to load if not needed. You can change to a different CAD model or variant at any time by selecting a different item from the dropdown boxes and clicking <span class="guilabel">Load</span> again.</p>
<div class="section" id="cad-mouse-navigation">
<h3>CAD Mouse Navigation<a class="headerlink" href="#cad-mouse-navigation" title="Permalink to this headline">¶</a></h3>
<p>You can interactively navigate around the CAD model using the following mouse controls:</p>
<ul class="simple">
<li><code class="kbd docutils literal"><span class="pre">Right</span> <span class="pre">Click</span> <span class="pre">+</span> <span class="pre">Drag</span></code> - Look around (first-person shooter style control; default) or rotate CAD model depending on settings</li>
<li><code class="kbd docutils literal"><span class="pre">Middle</span> <span class="pre">Click</span> <span class="pre">+</span> <span class="pre">Drag</span></code> - Pan (translate) sideways i.e. in the plane of the monitor.</li>
<li><code class="kbd docutils literal"><span class="pre">Scroll</span> <span class="pre">Wheel</span></code> - Move forwards or backwards.</li>
<li><code class="kbd docutils literal"><span class="pre">Ctrl</span> <span class="pre">+</span> <span class="pre">Scroll</span> <span class="pre">Wheel</span></code> Reduce or increase the CAD field-of-view angle (i.e. Zoom)</li>
<li><code class="kbd docutils literal"><span class="pre">Ctrl</span> <span class="pre">+</span> <span class="pre">Right</span> <span class="pre">Click</span> <span class="pre">+</span> <span class="pre">Drag</span></code> - Roll the camera (rotate about the direction of view)</li>
</ul>
</div>
<div class="section" id="turning-cad-model-parts-on-off">
<h3>Turning CAD model parts On/Off<a class="headerlink" href="#turning-cad-model-parts-on-off" title="Permalink to this headline">¶</a></h3>
<p>For CAD models composed of multiple parts in separate mesh files, individual mesh files can be turned on or off by ticking/unticking them in the <span class="guilabel">Enable / Disable Features</span> panel. This can be done for individual parts, groups of parts (if defined in the CAD model) or the entire model. This can be helpful to improve performance when working with large models if not all parts are necessary for a particular calibration, or for removing parts which are in the way and make the calibration more difficult.</p>
</div>
<div class="section" id="d-viewport-tab">
<h3>3D ViewPort Tab<a class="headerlink" href="#d-viewport-tab" title="Permalink to this headline">¶</a></h3>
<p>In addition to the mouse controls, the <span class="guilabel">3D Viewport</span> tab  can be used to control the current view of the CAD model. At the top of this tab is a list of viewports defined in the CAD model definition. Clicking on a view in this pane immediately changes the CAD viewport to that view. You can also set the view to match an existing calibrated camera by clicking the <span class="guilabel">Add from calibration(s)...</span> button below the viewport list. You can then select one or more Calcam calibration files to load, and the views defined by the calibration will be added to the viewport list on the 3D Viewport tab.</p>
<p>If you want to save the current view of the CAD model in to the model definition so you can easily return to it, enter a name in the <span class="guilabel">Name</span> box under the heading <span class="guilabel">Save current view as preset</span> and click <span class="guilabel">Save</span>. The view will then be added to the viewport list, and if the model definition you are using is not read-only, will be saved to the model definition for future use.</p>
<p>Near the bottom of the tab are editable boxes showing the current viewport&#8217;s camera position, camera view target, field of view and roll. These update automatically to reflect the current viewport, and you can manually set up the CAD view by editing these.</p>
<p>At the bottom of this tab are options for configuring the mouse controls for CAD navigation. The <code class="kbd docutils literal"><span class="pre">Right</span> <span class="pre">Click</span> <span class="pre">+</span> <span class="pre">Drag</span></code> behaviour can be toggled between looking around and rotating the model about a point in front of the camera, and the mouse sensitivity can be adjusted.</p>
</div>
</div>
<div class="section" id="defining-calibration-points">
<h2>Defining Calibration Points<a class="headerlink" href="#defining-calibration-points" title="Permalink to this headline">¶</a></h2>
<p>Calcam uses <em>point pairs</em> to perform the calibration, where a point pair consists of one point on the CAD model and its corresponding point on the image. Point pairs are displayed on the CAD and image views as red <strong>+</strong> cursors at the point locations. At any given time, one point pair can be selected for editing. The selected point pair will be indicated with larger green <strong>+</strong> cursors.</p>
<p>Once you have identified a common feature on the image and CAD model, <code class="kbd docutils literal"><span class="pre">Ctrl</span> <span class="pre">+</span> <span class="pre">Click</span></code>  on the location on either the image or CAD view to create a new point pair. A point will be placed at the mouse location. Then click, without holding <code class="kbd docutils literal"><span class="pre">Ctrl</span></code>, the corresponding point on the other view to finish creating the point pair. You should now see green cursors on both the CAD model and image. Clicking either the CAD model or image again will move the green cursor representing the current point to the clicked location. To start another point pair, <code class="kbd docutils literal"><span class="pre">Ctrl</span> <span class="pre">+</span> <span class="pre">Click</span></code> again and repeat the process. The cursors showing the existing points will turn red, indicating they are no longer selected. In general, left clicking on either the image or CAD model will move the currently selected point to the clicked location. Clicking an existing cursor will select that point pair for editing, and holding <code class="kbd docutils literal"><span class="pre">Ctrl</span></code> while clicking will start a new point pair.</p>
<p>If you start a new point pair before specifying both CAD and image points for an existing pair (e.g. by <code class="kbd docutils literal"><span class="pre">Ctrl+Click</span></code> on the image twice in a row), this will delete the current &#8216;un-paired&#8217; point and start a new point pair.</p>
<p>The currently selected point pair can be deleted by pressing the <code class="kbd docutils literal"><span class="pre">Del</span></code> key on the keyboard, or clicking the <span class="guilabel">Remove selected</span> button on the <span class="guilabel">Calibration Points</span> tab.</p>
<p>For more information, the current number of calibration points and coordinates of the currently selected points are shown in the <span class="guilabel">Calibration Points</span> control tab.</p>
<p>You can load a set of point pairs from an existing calcam calibration or point pairs <code class="docutils literal"><span class="pre">.csv</span></code> file as a starting point on the <span class="guilabel">Calibration Points</span> tab.</p>
<div class="section" id="using-additional-intrinsics-constraints">
<h3>Using Additional Intrinsics Constraints<a class="headerlink" href="#using-additional-intrinsics-constraints" title="Permalink to this headline">¶</a></h3>
<p>In many examples of real images, only a relatively small number of point pairs can be accurately identified. Due to the large number of free parameters in the camera model fit (focal length(s), centre of perspective, camera 3D position and orientation and distortion parameters) this can often give poor quality results. It is possible to better constrain the fits by using either existing calcam calibrations of the same camera + lens, or with images of a chessboard pattern, with known square size, taken with the same camera &amp; lens in the lab. These add aditional constraints on the intrinsic model parameters, meaning only enough points to reliably fit the extrinsic parameters need to be identified in the image of the machine and better quality fits can be achieved. Extra intrinsics constraints can be loaded on the <span class="guilabel">Calibration Points</span> tab, under the <span class="guilabel">Additional Intrinsics Constraints</span> section. This section provides <span class="guilabel">Load...</span> buttons for both types of constraints. Once loaded, these can be included or excluded from being used for the fitting using the checkboxes next to the intrinsics constraint names.</p>
<div class="section" id="chessboard-images">
<h4>Chessboard Images<a class="headerlink" href="#chessboard-images" title="Permalink to this headline">¶</a></h4>
<p>It is recommended to take chessboard images for intrinsics calibration whenever possible to improve calibraition results. The images bust be taken with exact camera and lens configuration as used on the machine.</p>
<p>To prepare chessboard images: make a flat chessboard target with known square size (there are various printable PDFs available by searching online). Then take a number of images with this chessboard target in front of the camera at a variety of positions, orientations and distances to the camera. The example below shows thumbnails of a set of chessboard calibration images:</p>
<img alt="Chessboard image example thumbnails" class="align-left" src="_images/chessboard_example.png" />
<p>Chessboard images are loaded in to Calcam from the <span class="guilabel">Calibration Points</span> tab. Clicking the <span class="guilabel">Load...</span> button next to Chessboard Images in the <span class="guilabel">Additional Intrinsics Constraints</span> section will open the following window:</p>
<img alt="Chessboard dialog screenshot" class="align-left" src="_images/chessboard_dialog.png" />
<p>Chessboard loading consists of 3 steps, done in order by working down the right hand side of this window. First, browse for and select all of the chessboard images to use. Then, enter the details of the chessboard pattern: number of squares and square size. Then, select the <span class="guilabel">Detect Chessboard Corners</span> button to run an automatic detection of the boundaries between the chessboard squares. If the automatic detection fails on some images, a dialog box will open telling you which images the detection failed for, and that those cannot be used. If all images fail, check that the number of squares input is correct. Once the corner detection has been completed, cursors will be added to the image displayed on the left hand side of the window. You can pan and zoom to inspect the cursor positions using the usual image mouse controls, and look at different images using the <span class="guilabel">&lt;&lt;</span> and <span class="guilabel">&gt;&gt;</span> buttons above the image. To complete loading of the images and use these as intrinsics constraints, click <span class="guilabel">Apply</span>.</p>
</div>
<div class="section" id="existing-calibrations">
<h4>Existing Calibrations<a class="headerlink" href="#existing-calibrations" title="Permalink to this headline">¶</a></h4>
<p>If loading an existing calibration to use for intrinsics constraint, the intrinsics from the existing calibration are not used directly for the new one, but rather the point pairs from the main image and any additional intrinsics constraints (e.g. chessboard images) already included in that calibration will be used as additional fit input data to constrain the camera intrinsics. Copies of the image(s) and point pairs from the opened calibration will be stored in the new calibration to maintain full traceability of the input data used for the calibration.</p>
</div>
</div>
</div>
<div class="section" id="fitting-the-camera-model">
<h2>Fitting the camera model<a class="headerlink" href="#fitting-the-camera-model" title="Permalink to this headline">¶</a></h2>
<p>Once enough point pairs have been identified, fitting of the camera model and checking the fit accuracy are done using the <span class="guilabel">Calibration Fitting</span> tab. At the top of this page is a set of tabs concerning each sub-view in the image, since each sub-view is calibrated independently. The following description of the fitting options and results display applies to each tab.</p>
<div class="section" id="fit-options">
<h3>Fit Options<a class="headerlink" href="#fit-options" title="Permalink to this headline">¶</a></h3>
<p>At the top of the page are the fitting &amp; camera model options. The default options will typically produce good results for most images, however in some cases they will need to be adjusted to get a good quality result.</p>
<p>The first option to choose is whether to use the perspective or fisheye lens distortion model: these two can be switched using the radio buttons at the top of the fit options section. Depending on the selected model, some or all of the following options will be available:</p>
<ul class="simple">
<li><span class="guilabel">Disable k1...k3</span> These options, when checked, cause the corresponding radial distortion coefficients in the distortion model to be fixed at 0 in the fit. This can be used to change the order of the radial distortion model, and disables radial distortion entirely if all three are checked. Disabling higher order radial distortion terms can improve fits when the point pairs do not sufficiently constrain the distortion model, when the fitted results can show large erroneous distortions.</li>
<li><span class="guilabel">Disable Tangential Distortion</span> This option sets the coefficients <span class="math">\(p_1\)</span> and <span class="math">\(p_2\)</span> in the distortion model to be fixed at 0 in the fit, i.e. disables tangential distortion in the fitted model. This can be helpful if the fitting results in large erroneous values of these coefficients.</li>
<li><span class="guilabel">Fix Fx = Fy</span> This option fixes the focal lengths in the horizontal and vertical directions to be equal, i.e. fixes the image aspect ratio to 1. This is enabled by default, since for square pixels and non-anamorphic optics, which is the typical case, <span class="math">\(f_x = f_y\)</span> is expected. Un-checking this option can sometimes help fit quality for some optical systems.</li>
</ul>
<p>At the bottom of the fit options section is the <span class="guilabel">Do Fit</span> button which is used to run the fit with the current options. Alternatively, the keyboard shortcut <code class="kbd docutils literal"><span class="pre">Ctrl</span> <span class="pre">+</span> <span class="pre">F</span></code> also performs a fit with the current settings for the current sub-view.</p>
</div>
<div class="section" id="fit-results-checking-accuracy">
<h3>Fit Results &amp; Checking Accuracy<a class="headerlink" href="#fit-results-checking-accuracy" title="Permalink to this headline">¶</a></h3>
<p>As soon as a fit is performed, a set of re-projected points are shown on the image as blue  <strong>+</strong> cursors. These are the CAD model points from the current point pairs converted to image coordinates using the fitted model, i.e. for a good fit, these should lie on top of the user-placed red cursors. Display of the fitted points can be turned on or off using the <span class="guilabel">Show fitted points</span> checkbox, or pressing <code class="kbd docutils literal"><span class="pre">Ctrl</span> <span class="pre">+</span> <span class="pre">P</span></code> on the keyboard. Once a fit is performed, a <span class="guilabel">Fit Results</span> section is displayed below the fit options and contains quantitative information about the fit results. These include the RMS fit residual and fitted extrinsic and intrinsic parameters (camera pupil position and view direction, field of view, focal length, centre of perspective and distortion parameters). <em>Beware</em>: for fits with small numbers of point pairs, the camera model has sufficiently many free parameters that a very small RMS fit error and good looking re-projected point positions can be obtained with a fit which is actually very bad!</p>
<p>A much more most robust and thorough visual check of the fit quality can be obtained by overlaying the CAD model wireframe on top of the camera image, with the wireframe rendered according to the fit results. Careful inspection of the alignment of this wireframe overlay is the recommended method for checking fit results. The overlay can be turned on by ticking the <span class="guilabel">Show wireframe overlay</span> box, or pressing <code class="kbd docutils literal"><span class="pre">Ctrl</span> <span class="pre">+</span> <span class="pre">O</span></code> on the keyboard. The CAD model is then rendered in wireframe and superimposed on the image. Note: for large images or CAD models this can be somewhat slow and memory intensive.</p>
<p>Another way to quickly get a rough idea of the fit quality, or to make subequent adding or editing of point pairs easier, is to set the CAD viewport to match the fitted model using the <span class="guilabel">Set CAD view to match fit</span> button. This will set the view of the CAD model to approximately match the fitted camera, including the position, orientation and overall field of view but neglecting any distortion and de-centring.</p>
<p>Note: Fit results are cleared automatically the next time the point pairs are edited in any way, to ensure any fit displayed or saved always corresponds to the current state of the point pairs.</p>
</div>
</div>
<div class="section" id="saving-loading-and-viewing-calibration-information">
<h2>Saving / Loading and viewing calibration information<a class="headerlink" href="#saving-loading-and-viewing-calibration-information" title="Permalink to this headline">¶</a></h2>
<p>Once a satisfactory calibration has been obtained, the calibration can be saved to a Calcam calibration (<code class="docutils literal"><span class="pre">.ccc</span></code>) file using the <span class="guilabel">Save</span> / <span class="guilabel">Save As</span> buttons on the toolbar at the top of the window. The resulting file can then be loaded in the image analyser tool or using the Calcam <a class="reference internal" href="api_analysis.html"><span class="doc">Python API</span></a> to make use of the calibration. As with any computer application, it is advised to save your work regularly in case of computer crash or user error. You do not have to have a complete calibration in order to save; a calibration containing just an image, an image and point pairs or a full set of image, point pairs and fit can be saved and returned to later.</p>
<p>Existing calibrations can be loaded using the <span class="guilabel">Open</span> button in the toolbar at the top of the window. This will load the image, point pairs and fit results from the selected calibration file. If the CAD model which was last used for thet calibration is available, it will also load and set up the CAD model as it was the last time that file was edited.</p>
<p>Information about the current calibration can be viewed using the <span class="guilabel">Calibration Information</span> button on the toolbar.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="gui_alignment_calib.html" class="btn btn-neutral float-right" title="Calibration by manual alignment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="gui_intro.html" class="btn btn-neutral" title="Calcam GUI tools and launcher" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2018, European Atomic Energy Community (EURATOM).

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>