

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Calibration by point fitting &mdash; Calcam  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Calibration by manual alignment" href="gui_alignment_calib.html" />
    <link rel="prev" title="Calcam Settings" href="gui_settings.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                Version 2.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro_general.html">General Introduction to Calcam</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro_install_setup.html">Getting Up &amp; Running</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro_theory.html">Camera Calibration Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro_conventions.html">Concepts &amp; Conventions</a></li>
</ul>
<p class="caption"><span class="caption-text">GUI App User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gui_intro.html">Introduction &amp; Launcher</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui_settings.html">Calcam Settings</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Calibration by point fitting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#loading-an-image-to-calibrate">Loading an Image to Calibrate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#image-mouse-navigation">Image Mouse Navigation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#current-image-settings">Current Image Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loading-and-manipulating-a-cad-model">Loading and manipulating a CAD model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#defining-calibration-points">Defining Calibration Points</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fitting-the-camera-model">Fitting the camera model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#saving-loading-and-viewing-calibration-information">Saving / Loading and viewing calibration information</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gui_alignment_calib.html">Calibration by manual alignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui_virtual_calib.html">“Virtual” Calibrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui_image_analyser.html">Image Analyser</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui_viewer.html">3D Viewer</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui_movement.html">Camera Movement Determination</a></li>
</ul>
<p class="caption"><span class="caption-text">API User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api_calib.html">The Calibration Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_cadmodel.html">CAD Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_raycast.html">Ray Casting</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_rendering.html">Rendering Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_geom_matrix.html">Tomography Geometry Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_movement.html">Camera Movement Correction</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_examples.html">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dev_imsources.html">Image Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_coord_formatter.html">3D Coordinate Formatters</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Calcam</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Calibration by point fitting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="calibration-by-point-fitting">
<h1>Calibration by point fitting<a class="headerlink" href="#calibration-by-point-fitting" title="Permalink to this headline">¶</a></h1>
<p>The point fitting calibration tool is the main GUI tool for performing camera calibrations. An image from a camera to be calibrated and a CAD model of the camera’s view are shown side-by-side, and the user then identifies pairs of corresponding points between the image and CAD model. These point pairs are then used to fit the camera calibration.</p>
<p>A screenshot of the calibration tool GUI is shown below, with the main areas annotated. At the top of the window is a toolbar with buttons to start a new calibration, open an existing calibration or save / save as the current calibration. Most of the space in the main window is taken by the side-by-side CAD and image views, where the CAD model and image to be calibrated are displayed. On the right-hand side of the window are the “control tabs”, a set of tabs where the rest of the controls reside.</p>
<img alt="Calibration tool screenshot" class="align-left" src="_images/calib_points_annotated.png" />
<div class="section" id="loading-an-image-to-calibrate">
<h2>Loading an Image to Calibrate<a class="headerlink" href="#loading-an-image-to-calibrate" title="Permalink to this headline">¶</a></h2>
<p>At the top of the <span class="guilabel">Camera Image</span> control tab is a group of controls for loading an image you want to calibrate. The <span class="guilabel">From</span> dropdown list selects the source from which you want to load the image. The options available as standard are loading from an image file (default) or loading an image from another Calcam calibration. If you define any custom image sources (see <a class="reference internal" href="dev_imsources.html"><span class="doc">Image Sources</span></a>), they will also appear in this dropdown menu. Once an image source is selected, the relevant inputs to set up the image loading appear below the dropdown list. Once the relevant fields are completed, click the <span class="guilabel">Load</span> button to load the image.</p>
<p>If loading an image with an existing calibration already open, e.g. to update a calibration using a more recent reference image, the loaded image must have the same dimensions as the one it is replacing. If you try to load an image with different dimensions, a dialog box will appear asking whether you want to start a new calibration or cancel loading the image. If the new image is compatible with the existing calibration, a dialog will open asking if you want to use the <a class="reference internal" href="gui_movement.html"><span class="doc">Camera Movement Determination</span></a> tool to determine the movement between the existing image and newly loaded one. If you do this, the movement found using the <a class="reference internal" href="gui_movement.html"><span class="doc">Camera Movement Determination</span></a> tool will be used to update all calibration points at once to align them with the new image.</p>
</div>
<div class="section" id="image-mouse-navigation">
<h2>Image Mouse Navigation<a class="headerlink" href="#image-mouse-navigation" title="Permalink to this headline">¶</a></h2>
<p>Once an image is loaded, you can interactively zoom and pan the image with the following mouse controls:</p>
<ul class="simple">
<li><p><kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Scroll</kbd> <kbd class="kbd docutils literal notranslate">Wheel</kbd></kbd> - Zoom in or out, centred at the current mouse position.</p></li>
<li><p><kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Middle</kbd> <kbd class="kbd docutils literal notranslate">Click</kbd> <kbd class="kbd docutils literal notranslate"></kbd>+<kbd class="kbd docutils literal notranslate"></kbd> <kbd class="kbd docutils literal notranslate">Drag</kbd></kbd> - Drag the image around.</p></li>
</ul>
</div>
<div class="section" id="current-image-settings">
<h2>Current Image Settings<a class="headerlink" href="#current-image-settings" title="Permalink to this headline">¶</a></h2>
<p>With an image loaded, the <span class="guilabel">Current Image</span> section appears on the <span class="guilabel">Camera Image</span> tab, containing information and settings for the current image. Controls include</p>
<ul class="simple">
<li><p><strong>Known Pixel Size</strong>: If you know the pixel size of the camera, it can be entered here. This does not make any difference to the calibration except that focal lengths can be displayed in units of mm instead of pixels, which can be useful for sanity checking results e.g. comparing with optical designs or known lenses.</p></li>
<li><p><strong>Geometrical Transformations</strong>: Controls for transforming the image to get it the “right way up”. It is recommended to always load images in to Calcam the way they come out straight from the camera, then use these controls to get the image right-way-up for calibration. The :guilabell:Stretch Vertically by’ button is provided for cameras with non-square pixels or anamorphic optics. Although images can still be calibrated if you leave them rotated, you must use these controls to remove any horizontal or vertical flip from the image, otherwise the calibration will not work.</p></li>
<li><p><strong>Apply Image Enhancement</strong>: Enabling this option will attempt to enhance the displayed image to increase the contrast and visibility of image features which might be useful for calibration.</p></li>
</ul>
<div class="section" id="view-masking">
<h3>View Masking<a class="headerlink" href="#view-masking" title="Permalink to this headline">¶</a></h3>
<p>For many camera systems, not every pixel on the detector should have the same calibration applied. In some systems the image projected by the optics does not fill the whole sensor, and some systems consist of multiple views in different directions, optically combined on to a single detector. Calcam supports these types of systems by allowing you to set up a mask specifying which pixels contain what image. This can be set up by clicking the <span class="guilabel">Define…</span> button beside the text <span class="guilabel">Image masking and &amp; sub-views</span>. Pressing the button opens the following dialog box:</p>
<img alt="Sub-view window screenshot" class="align-left" src="_images/subviews_start.png" />
<p>This window shows the image on the left, with any mask shown by different coloured shading. Below the image is a slider which can be used to control the opacity of the shading. Mouse navigation controls for the image are the same as for the image in the main calibration window. On the right-of the window are the different options you can select for defining the image masking:</p>
<div class="section" id="no-masking">
<h4>No Masking<a class="headerlink" href="#no-masking" title="Permalink to this headline">¶</a></h4>
<p>This is the default for a newly loaded image. Use this option if you have a straightforward image with all of the sensor area used.</p>
</div>
<div class="section" id="image-surrounded-by-dark-border">
<h4>Image Surrounded by Dark Border<a class="headerlink" href="#image-surrounded-by-dark-border" title="Permalink to this headline">¶</a></h4>
<p>This option is used for cases where the optical image does not fill the whole sensor - the image takes up some of the sensor area but is surrounded by a dark border where there is no real image. When selected, this option lets you click on areas where there is no image to “flood fill” a mask excluding those pixels from calibration. When you select this option, the entire image is shown shaded in colour. As you click on areas to mark them as not containing image, these ares become shaded grey. Clicking on the image multiple times adds whatever area is clicked to the excluded area. If the flood fill algorithm selects too little or too much of the image, you can adjust the threshold and median filter size for the flood fill algorithm with the provided controls. Increasing these values means a larger area will be selected with each click. If you select too much area to exclude and need to start again, use the <span class="guilabel">Reset</span> button to clear the masking and start again. When finished, the part of the sensor containing the image should be shown with a colour overlay while the part containing no image should be shaded grey, like the example below.</p>
<img alt="Sub-view window screenshot" class="align-left" src="_images/subviews2.png" />
</div>
<div class="section" id="sub-views-separated-by-a-straight-line">
<h4>2 Sub-views separated by a straight line<a class="headerlink" href="#sub-views-separated-by-a-straight-line" title="Permalink to this headline">¶</a></h4>
<p>This option can be used where there are 2 different fields of view (‘sub-views’) optically combined on to a single detector, with a straight line border between the two. When this option is selected, you can click two points on the image to define the line which separates the two sub-views. Once the points are placed, clicking on the image again moves the selected point (shown in green) to the clicked position. The other point can be selected by clicking it.</p>
<ul class="simple">
<li><p><strong>Custom mask</strong> for images with more than 2 sub-views or where the boundary between the sub-views is not a straight line. To use this function, prepare an image file the same size as the image to be calibrated with blocks of different solid colours representing each sub-view. You can then load this image file and the blocks of different colours will be used to define the coverage of the different sub-views.</p></li>
</ul>
<p>Once the positions of the sub-views have been configured, on the lower-right of the window are boxes to enter human-friendly names for the different sub-views (see screenshot below). These will be used to identify the sub-views elsewhere in the GUI and calibration information.</p>
</div>
<div class="section" id="arbitrary-mask">
<h4>Arbitrary Mask<a class="headerlink" href="#arbitrary-mask" title="Permalink to this headline">¶</a></h4>
<p>This option can be used to treat more complicated situations, like if there are more than 2 different ‘sub-views’ combined on the sensor; multiple views plus some parts of the image with no image; or parts of the image are blocked by features not included in the CAD model and you wish to mark them as not containing useful images. In this case, you should prepare an image file, the same dimensions as the image being calibrated, where the distinct regions are flood-filled with different colours. You can then load this image using the <span class="guilabel">Load Mask Image</span> button and it will be used to define the image mask. The example below shows a case of an image from JET where the detector includes 2 different optically-combined views, plus some unused area:
It is often useful to save a copy of the image being calibrated to use as a template / layer when creating the mask image. You can save a copy of the image being calibrated using the <span class="guilabel">Save Calibration Image…</span> button.</p>
<p>Once the mask image is loaded, you can give each region of the image a human-friendly name using the boxes on the right, and use the tick boxes to indicate which regions contain image to be calibrated and which do not contain image data:</p>
<img alt="Sub-view window screenshot" class="align-left" src="_images/subviews.png" />
<p>When you are happy with the image masking configuration, click <span class="guilabel">Apply</span>. If you click <span class="guilabel">cancel</span>, no change will be applied to the masking configuration.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>After changing the masking configuration, any existing calibration fit(s) will be reset so you will have to re-run the calibration fitting.</p>
</div>
</div>
</div>
</div>
<div class="section" id="loading-and-manipulating-a-cad-model">
<h2>Loading and manipulating a CAD model<a class="headerlink" href="#loading-and-manipulating-a-cad-model" title="Permalink to this headline">¶</a></h2>
<p>At the top the <span class="guilabel">Machine Model</span> control tab are controls for loading a CAD model to calibrate against. Two dropdown boxes are provided to select the CAD model to load and the <a class="reference internal" href="intro_conventions.html#cadmodel-intro"><span class="std std-ref">model variant</span></a>. The <span class="guilabel">Load</span> button to the right of the model variant then loads the model. Underneath the model variant dropdown box is a checkbox labeled <cite>Enable default model features on load</cite>: if checked, the default parts of the CAD model are all loaded as soon as the model itself is loaded. If not checked, the model definition will be loaded but none of the 3D mesh data will be loaded, and instead you can turn on features individually. This is useful if working with a large model on a slow computer where you don’t want to wait for the whole model to load if not needed. You can change to a different CAD model or variant at any time by selecting a different item from the dropdown boxes and clicking <span class="guilabel">Load</span> again.</p>
<div class="section" id="cad-mouse-navigation">
<h3>CAD Mouse Navigation<a class="headerlink" href="#cad-mouse-navigation" title="Permalink to this headline">¶</a></h3>
<p>You can interactively navigate around the CAD model using the following mouse controls:</p>
<ul class="simple">
<li><p><kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Right</kbd> <kbd class="kbd docutils literal notranslate">Click</kbd> <kbd class="kbd docutils literal notranslate"></kbd>+<kbd class="kbd docutils literal notranslate"></kbd> <kbd class="kbd docutils literal notranslate">Drag</kbd></kbd> - Look around (first-person shooter style control; default) or rotate CAD model depending on settings</p></li>
<li><p><kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Middle</kbd> <kbd class="kbd docutils literal notranslate">Click</kbd> <kbd class="kbd docutils literal notranslate"></kbd>+<kbd class="kbd docutils literal notranslate"></kbd> <kbd class="kbd docutils literal notranslate">Drag</kbd></kbd> - Pan (translate) sideways i.e. in the plane of the monitor.</p></li>
<li><p><kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Scroll</kbd> <kbd class="kbd docutils literal notranslate">Wheel</kbd></kbd> - Move forwards or backwards.</p></li>
<li><p><kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd> <kbd class="kbd docutils literal notranslate"></kbd>+<kbd class="kbd docutils literal notranslate"></kbd> <kbd class="kbd docutils literal notranslate">Scroll</kbd> <kbd class="kbd docutils literal notranslate">Wheel</kbd></kbd> Reduce or increase the CAD field-of-view angle (i.e. Zoom)</p></li>
<li><p><kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd> <kbd class="kbd docutils literal notranslate"></kbd>+<kbd class="kbd docutils literal notranslate"></kbd> <kbd class="kbd docutils literal notranslate">Right</kbd> <kbd class="kbd docutils literal notranslate">Click</kbd> <kbd class="kbd docutils literal notranslate"></kbd>+<kbd class="kbd docutils literal notranslate"></kbd> <kbd class="kbd docutils literal notranslate">Drag</kbd></kbd> - Roll the camera (rotate about the direction of view)</p></li>
</ul>
</div>
<div class="section" id="turning-cad-model-parts-on-off">
<h3>Turning CAD model parts On/Off<a class="headerlink" href="#turning-cad-model-parts-on-off" title="Permalink to this headline">¶</a></h3>
<p>For CAD models composed of multiple parts in separate mesh files, individual mesh files can be turned on or off by ticking/unticking them in the <span class="guilabel">Enable / Disable Features</span> panel. This can be done for individual parts, groups of parts (if defined in the CAD model) or the entire model. This can be helpful to improve performance when working with large models if not all parts are necessary for a particular calibration, or for removing parts which are in the way and make the calibration more difficult.</p>
</div>
<div class="section" id="d-viewport-tab">
<h3>3D ViewPort Tab<a class="headerlink" href="#d-viewport-tab" title="Permalink to this headline">¶</a></h3>
<p>In addition to the mouse controls, the <span class="guilabel">3D Viewport</span> tab  can be used to control the current view of the CAD model. At the top of this tab is a list of viewports defined in the CAD model definition. Clicking on a view in this pane immediately changes the CAD viewport to that view. You can also set the view to match an existing calibrated camera by clicking the <span class="guilabel">Add from calibration(s)…</span> button below the viewport list. You can then select one or more Calcam calibration files to load, and the views defined by the calibration will be added to the viewport list on the 3D Viewport tab.</p>
<p>If you want to save the current view of the CAD model in to the model definition so you can easily return to it, enter a name in the <span class="guilabel">Name</span> box under the heading <span class="guilabel">Save current view as preset</span> and click <span class="guilabel">Save</span>. The view will then be added to the viewport list, and if the model definition you are using is not read-only, will be saved to the model definition for future use.</p>
<p>Near the bottom of the tab are editable boxes showing the current viewport’s camera position, camera view target, field of view and roll. These update automatically to reflect the current viewport, and you can manually set up the CAD view by editing these.</p>
<p>At the bottom of this tab are options for configuring the mouse controls for CAD navigation. The <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Right</kbd> <kbd class="kbd docutils literal notranslate">Click</kbd> <kbd class="kbd docutils literal notranslate"></kbd>+<kbd class="kbd docutils literal notranslate"></kbd> <kbd class="kbd docutils literal notranslate">Drag</kbd></kbd> behaviour can be toggled between looking around and rotating the model about a point in front of the camera, and the mouse sensitivity can be adjusted.</p>
</div>
</div>
<div class="section" id="defining-calibration-points">
<h2>Defining Calibration Points<a class="headerlink" href="#defining-calibration-points" title="Permalink to this headline">¶</a></h2>
<p>Calcam uses <em>point pairs</em> to perform the calibration, where a point pair consists of one point on the CAD model and its corresponding point on the image. Point pairs are displayed on the CAD and image views as red <strong>+</strong> cursors at the point locations. At any given time, one point pair can be selected for editing. The selected point pair will be indicated with larger green <strong>+</strong> cursors.</p>
<p>Once you have identified a common feature on the image and CAD model, <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd> <kbd class="kbd docutils literal notranslate"></kbd>+<kbd class="kbd docutils literal notranslate"></kbd> <kbd class="kbd docutils literal notranslate">Click</kbd></kbd>  on the location on either the image or CAD view to create a new point pair. A point will be placed at the mouse location. Then click, without holding <kbd class="kbd docutils literal notranslate">Ctrl</kbd>, the corresponding point on the other view to finish creating the point pair. You should now see green cursors on both the CAD model and image. Clicking either the CAD model or image again will move the green cursor representing the current point to the clicked location. To start another point pair, <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd> <kbd class="kbd docutils literal notranslate"></kbd>+<kbd class="kbd docutils literal notranslate"></kbd> <kbd class="kbd docutils literal notranslate">Click</kbd></kbd> again and repeat the process. The cursors showing the existing points will turn red, indicating they are no longer selected. In general, left clicking on either the image or CAD model will move the currently selected point to the clicked location. Clicking an existing cursor will select that point pair for editing, and holding <kbd class="kbd docutils literal notranslate">Ctrl</kbd> while clicking will start a new point pair.</p>
<p>If you start a new point pair before specifying both CAD and image points for an existing pair (e.g. by <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd>+<kbd class="kbd docutils literal notranslate">Click</kbd></kbd> on the image twice in a row), this will delete the current ‘un-paired’ point and start a new point pair.</p>
<p>The currently selected point pair can be deleted by pressing the <kbd class="kbd docutils literal notranslate">Delete</kbd> key on the keyboard, or clicking the <span class="guilabel">Remove selected</span> button on the <span class="guilabel">Calibration Points</span> tab.</p>
<p>The most recent change to the points can be un-done using your platform’s normal “Undo” keyboard shortcut (e.g. <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd>+<kbd class="kbd docutils literal notranslate">Z</kbd></kbd> on windows) or using the <span class="guilabel">Undo</span> button on the <span class="guilabel">Calibration Points</span> control tab. Up to 20 chanegs to the point pairs can be un-done in this way.</p>
<p>For more information, the current number of calibration points and coordinates of the currently selected points are shown in the <span class="guilabel">Calibration Points</span> control tab.</p>
<p>You can load a set of point pairs from an existing calcam calibration or point pairs <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file as a starting point on the <span class="guilabel">Calibration Points</span> tab.</p>
<div class="section" id="using-additional-intrinsics-constraints">
<h3>Using Additional Intrinsics Constraints<a class="headerlink" href="#using-additional-intrinsics-constraints" title="Permalink to this headline">¶</a></h3>
<p>In many examples of real images, only a relatively small number of point pairs can be accurately identified. Due to the large number of free parameters in the camera model fit (focal length(s), centre of perspective, camera 3D position and orientation and distortion parameters) this can often give poor quality results. It is possible to better constrain the fits by using either existing calcam calibrations of the same camera + lens, or with images of a chessboard pattern, with known square size, taken with the same camera &amp; lens in the lab. These add aditional constraints on the intrinsic model parameters, meaning only enough points to reliably fit the extrinsic parameters need to be identified in the image of the machine and better quality fits can be achieved. Extra intrinsics constraints can be loaded on the <span class="guilabel">Calibration Points</span> tab, under the <span class="guilabel">Additional Intrinsics Constraints</span> section. This section provides <span class="guilabel">Load…</span> buttons for both types of constraints. Once loaded, these can be included or excluded from being used for the fitting using the checkboxes next to the intrinsics constraint names.</p>
<div class="section" id="chessboard-images">
<h4>Chessboard Images<a class="headerlink" href="#chessboard-images" title="Permalink to this headline">¶</a></h4>
<p>It is recommended to take chessboard images for intrinsics calibration whenever possible to improve calibraition results. The images bust be taken with exact camera and lens configuration as used on the machine.</p>
<p>To prepare chessboard images: make a flat chessboard target with known square size (there are various printable PDFs available by searching online). Then take a number of images with this chessboard target in front of the camera at a variety of positions, orientations and distances to the camera. The example below shows thumbnails of a set of chessboard calibration images:</p>
<img alt="Chessboard image example thumbnails" class="align-left" src="_images/chessboard_example.png" />
<p>Chessboard images are loaded in to Calcam from the <span class="guilabel">Calibration Points</span> tab. Clicking the <span class="guilabel">Load…</span> button next to Chessboard Images in the <span class="guilabel">Additional Intrinsics Constraints</span> section will open the following window:</p>
<img alt="Chessboard dialog screenshot" class="align-left" src="_images/chessboard_dialog.png" />
<p>Chessboard loading consists of 3 steps, done in order by working down the right hand side of this window. First, browse for and select all of the chessboard images to use. Then, enter the details of the chessboard pattern: number of squares and square size. Then, select the <span class="guilabel">Detect Chessboard Corners</span> button to run an automatic detection of the boundaries between the chessboard squares. If the automatic detection fails on some images, a dialog box will open telling you which images the detection failed for, and that those cannot be used. If all images fail, check that the number of squares input is correct. Once the corner detection has been completed, cursors will be added to the image displayed on the left hand side of the window. You can pan and zoom to inspect the cursor positions using the usual image mouse controls, and look at different images using the <span class="guilabel">&lt;&lt;</span> and <span class="guilabel">&gt;&gt;</span> buttons above the image. To complete loading of the images and use these as intrinsics constraints, click <span class="guilabel">Apply</span>.</p>
</div>
<div class="section" id="existing-calibrations">
<h4>Existing Calibrations<a class="headerlink" href="#existing-calibrations" title="Permalink to this headline">¶</a></h4>
<p>If loading an existing calibration to use for intrinsics constraint, the intrinsics from the existing calibration are not used directly for the new one, but rather the point pairs from the main image and any additional intrinsics constraints (e.g. chessboard images) already included in that calibration will be used as additional fit input data to constrain the camera intrinsics. Copies of the image(s) and point pairs from the opened calibration will be stored in the new calibration to maintain full traceability of the input data used for the calibration.</p>
</div>
</div>
</div>
<div class="section" id="fitting-the-camera-model">
<h2>Fitting the camera model<a class="headerlink" href="#fitting-the-camera-model" title="Permalink to this headline">¶</a></h2>
<p>Once enough point pairs have been identified, fitting of the camera model and checking the fit accuracy are done using the <span class="guilabel">Calibration Fitting</span> tab. At the top of this page is a set of tabs concerning each sub-view in the image, since each sub-view is calibrated independently. The following description of the fitting options and results display applies to each tab.</p>
<div class="section" id="fit-options">
<h3>Fit Options<a class="headerlink" href="#fit-options" title="Permalink to this headline">¶</a></h3>
<p>At the top of the page are the fitting &amp; camera model options. The default options will typically produce good results for most images, however in some cases they will need to be adjusted to get a good quality result.</p>
<p>The first option to choose is whether to use the rectilinear or fisheye lens model: these two can be switched using the radio buttons at the top of the fit options section. Depending on the selected model, some or all of the following options will be available:</p>
<ul class="simple">
<li><p><span class="guilabel">Disable k1…k3</span> These options, when checked, cause the corresponding radial distortion coefficients in the distortion model to be fixed at 0 in the fit. This can be used to change the order of the radial distortion model, and disables radial distortion entirely if all three are checked. Disabling higher order radial distortion terms can improve fits when the point pairs do not sufficiently constrain the distortion model, when the fitted results can show large erroneous distortions.</p></li>
<li><p><span class="guilabel">Disable Tangential Distortion</span> This option sets the coefficients <span class="math notranslate nohighlight">\(p_1\)</span> and <span class="math notranslate nohighlight">\(p_2\)</span> in the distortion model to be fixed at 0 in the fit, i.e. disables tangential distortion in the fitted model. This can be helpful if the fitting results in large erroneous values of these coefficients.</p></li>
<li><p><span class="guilabel">Fix Fx = Fy</span> This option fixes the focal lengths in the horizontal and vertical directions to be equal, i.e. fixes the image aspect ratio to 1. This is enabled by default, since for square pixels and non-anamorphic optics, which is the typical case, <span class="math notranslate nohighlight">\(f_x = f_y\)</span> is expected. Un-checking this option can sometimes help fit quality for some optical systems.</p></li>
</ul>
<p>At the bottom of the fit options section is the <span class="guilabel">Do Fit</span> button which is used to run the fit with the current options. Alternatively, the keyboard shortcut <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd> <kbd class="kbd docutils literal notranslate"></kbd>+<kbd class="kbd docutils literal notranslate"></kbd> <kbd class="kbd docutils literal notranslate">F</kbd></kbd> also performs a fit with the current settings for the current sub-view.</p>
</div>
<div class="section" id="fit-results-checking-accuracy">
<h3>Fit Results &amp; Checking Accuracy<a class="headerlink" href="#fit-results-checking-accuracy" title="Permalink to this headline">¶</a></h3>
<p>As soon as a fit is performed, a set of re-projected points are shown on the image as blue  <strong>+</strong> cursors. These are the CAD model points from the current point pairs converted to image coordinates using the fitted model, i.e. for a good fit, these should lie on top of the user-placed red cursors. Display of the fitted points can be turned on or off using the <span class="guilabel">Show fitted points</span> checkbox in the <span class="guilabel">Fit Results Inspection</span> control group, or pressing <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd> <kbd class="kbd docutils literal notranslate"></kbd>+<kbd class="kbd docutils literal notranslate"></kbd> <kbd class="kbd docutils literal notranslate">P</kbd></kbd> on the keyboard. Once a fit is performed, a <span class="guilabel">Fit Results</span> section is displayed below the fit options and contains quantitative information about the fit results. These include the RMS fit residual and fitted extrinsic and intrinsic parameters (camera pupil position and view direction, field of view, focal length, centre of perspective and distortion parameters). <em>Beware</em>: for fits with small numbers of point pairs, the camera model has sufficiently many free parameters that a very small RMS fit error and good looking re-projected point positions can be obtained with a fit which is actually very bad!</p>
<p>A much more most robust and thorough visual check of the fit quality can be obtained by overlaying a render of the CAD model from the calibrated camera’s point of view on top of the camera image. Careful inspection of the alignment of this overlay is the recommended method for checking fit results. The overlay can be turned on by ticking the <span class="guilabel">Show CAD overlay</span> checkbox in the <span class="guilabel">Fit Results Inspection</span> control group. The CAD model is then rendered in wireframe and superimposed on the image. Note: for large images or CAD models this can be somewhat slow and memory intensive, particularly the first time it is run. By default the CAD model overlay will be rendered in wireframe to inspect the edges of CAD model features, but you can change the style between wireframe and solid-body using the dropdown box to the right of the <span class="guilabel">Show CAD overlay</span> checkbox. The colour and transparency of the CAD overlay can be adjusted using the controls which appear in this section when the overlay is turned on. For camera images of &lt;1000 pixels width or height, the overlay will be rendered at higher resolution than the camera image which allows a clearer comparison of the alignment.</p>
<p>Another way to quickly get a rough idea of the fit quality, or to make subequent adding or editing of point pairs easier, is to set the CAD viewport to match the fitted model using the <span class="guilabel">Set CAD view to match fit</span> button. This will set the view of the CAD model to approximately match the fitted camera, including the position, orientation and overall field of view but neglecting any distortion and de-centring.</p>
<p>Note: Fit results are cleared automatically the next time the point pairs are edited in any way, to ensure any fit displayed or saved always corresponds to the current state of the point pairs.</p>
</div>
<div class="section" id="comparison-with-another-calibration">
<h3>Comparison with another calibration<a class="headerlink" href="#comparison-with-another-calibration" title="Permalink to this headline">¶</a></h3>
<p>It may sometimes be desirable to compare the current calibration fit with a different calibration of the same camera, e.g. to judge the improvement of calibration accuracy compared to a previous version, or to see camera movement between an existing calibration and the current one. To enable this, it is possible to show the CAD overlay from a different calibration file on the image in addition to the one based on the current calibration fit. The controls for this are in the <span class="guilabel">Compare with existing Calibration</span> control group at the bottom of the <span class="guilabel">Calibration Fitting</span> tab. Clicking <span class="guilabel">Select…</span> will open a file browsing dialog where you can choose the other calibration that you want to compare. The other calibration must be for an image with the same pixel dimensions (in display orientation) as the current calibration. Once loaded, the name of the reference calibration is displayed to the left of the <span class="guilabel">Select…</span> button. The CAD overlay based on the loaded calibration is then rendered and placed on top of the image similarly to the one from the current calibration, and can be turned on or off using the <span class="guilabel">Show CAD overlay</span> checkbox. Like the CAD overlay from the current fit, the colour and opacity of the comparison overlay can be adjusted as desired.</p>
</div>
</div>
<div class="section" id="saving-loading-and-viewing-calibration-information">
<h2>Saving / Loading and viewing calibration information<a class="headerlink" href="#saving-loading-and-viewing-calibration-information" title="Permalink to this headline">¶</a></h2>
<p>Once a satisfactory calibration has been obtained, the calibration can be saved to a Calcam calibration (<code class="docutils literal notranslate"><span class="pre">.ccc</span></code>) file using the <span class="guilabel">Save</span> / <span class="guilabel">Save As</span> buttons on the toolbar at the top of the window. The resulting file can then be loaded in the <a class="reference internal" href="gui_image_analyser.html"><span class="doc">Image Analyser</span></a> tool or in Python with the <a class="reference internal" href="api_calib.html#calcam.Calibration" title="calcam.Calibration"><code class="xref py py-class docutils literal notranslate"><span class="pre">calcam.Calibration</span></code></a> class to make use of the calibration. As with any computer application, it is advised to save your work regularly in case of computer crash or user error. You do not have to have a complete calibration in order to save; a calibration containing just an image, an image and point pairs or a full set of image, point pairs and fit can be saved and returned to later.</p>
<p>Existing calibrations can be loaded using the <span class="guilabel">Open</span> button in the toolbar at the top of the window. This will load the image, point pairs and fit results from the selected calibration file. If the CAD model which was last used for thet calibration is available, it will also load and set up the CAD model as it was the last time that file was edited.</p>
<p>Information about the current calibration can be viewed using the <span class="guilabel">Calibration Information</span> button on the toolbar.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="gui_alignment_calib.html" class="btn btn-neutral float-right" title="Calibration by manual alignment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="gui_settings.html" class="btn btn-neutral float-left" title="Calcam Settings" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2015-2022, European Atomic Energy Community (EURATOM)

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>